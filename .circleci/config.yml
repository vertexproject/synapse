version: 2.1

# define this file as the setup phase of your dynamic configuration
setup: true

# invoke the orbs to pack and continue configs.
orbs:
  circleci-cli: circleci/circleci-cli@0.1.9
  continuation: circleci/continuation@1.0.0

jobs:
  setup:
    executor: continuation/default
    steps:
      - checkout

      # Install the CircleCI CLI
      - circleci-cli/install

      # Generate the shared configuration from a directory with the pack command.
      - run:
          name: Generate shared configuration
          command: circleci config pack .circleci/shared >> .circleci/shared-config.yml

      # Validate the generated configuration.
      - run:
          name: Validate config
          command: circleci config validate .circleci/shared-config.yml

      # Continue the pipeline with the generated configuration.
      - continuation/continue:
          configuration_path: .circleci/shared-config.yml

workflows:
  setup-workflow:
    jobs:
      - setup
